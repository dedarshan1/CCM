@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    @*<input type="text" id="message" />*@
    <select id="message">
        <option value="0">0</option>
         <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
         <option value="6">6</option>
    </select>
    <input type="button" id="sendmessage" value="Play" />    
    
  @*  <ul id="discussion">
     </ul>*@
    <div id="scoreR"></div>
    <br /><br /><br />
    <div style="display:inline" id="Pl1">Player 1 :</div> <label style="display:inline" id="PlSc1"></label> ( <label style="display:inline" id="Pl1Balls"></label> ) <br />
     <div style="display:inline" id="Pl2">Player 2 :</div> <div style="display:inline" id="PlSc2"></div> ( <label style="display:inline" id="Pl2Balls"></label> )
     <br />
    <br />
    <span style="display:inline">Over & Balls:</span> <div style="display:inline" id="over">0</div>.<span style="display:inline" id="noOfballs"></span>
    
</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
     <script src="~/Scripts/jquery.signalR-1.1.3.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
     <!--SignalR script to update the chat page and send messages.--> 
    <script>
        var overCnt = 0;
        $(function () {
            // Reference the auto-generated proxy for the hub.  
             var chat = $.connection.chatHub;
            var scorePl1 = 0;// counter to store score for player 1
            var scorePl2 = 0;// counter to store score for player 2
            var ballCounter = 0;
            var Pl1BallsCounter = 0;// counter to store balls played by player 1
            var Pl2BallsCounter = 0;// counter to store balls played by player 2
             var onStrike = '';
            var player1Name = $("#Pl1").text();
            var player2Name = $("#Pl2").text();
          
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, score) {
                alert('in score udpate:' + onStrike);
                if (onStrike == 'Player 1 :') {
                    scorePl1 = parseInt(scorePl1) + parseInt(score);
                     $('#PlSc1').html(scorePl1);
                }
                else if (onStrike == 'Player 2 :') {
                    scorePl2 = parseInt(scorePl2) + parseInt(score);
                    $('#PlSc2').html(scorePl2);
                 }
            };            
            // Get the user name and store it to prepend to messages.
            //$('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.  
             $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {

                    //check for 1,3 and end of over.In this case strike will be rotated
                     if (onStrike = '')
                        onStrike = player1Name;

                    if ($('#message').val() == '1')                       
                        onStrike = player2Name;
                     else
                        onStrike = player1Name;

                    if (ballCounter == 6) {
                        updateOver();
                        ballCounter = 0;
                    }
                     ballCounter++;
                    $('#noOfballs').html(ballCounter);
                    
                    
                    chat.server.updateScore(onStrike, $('#message').val());
                     //alert($("#Pl1").text());
                    if (onStrike == 'Player 1 :') {
                        Pl1BallsCounter++;
                        $('#Pl1Balls').html(Pl1BallsCounter);
                     }
                    if (onStrike == 'Player 2 :') {
                        Pl2BallsCounter++;
                        $('#Pl2Balls').html(Pl2BallsCounter);
                    }
                     // Clear text box and reset focus for next comment. 
                    $('#message').val('').focus();
                });
            });
        });
       
        var updateOver = function ()
         {
            overCnt = overCnt + 1;
            $('#over').html(overCnt);
        };
    </script>
}
